# MySQL 서버 업그레이드 

MySQL 서버를 업그레이드 하는 방법은 아래 두가지다.

1. 인플레이스 업그레이드 : 데이터 파일을 그대로두고 업데이트
2. 로지컬 업그레이드 : mysqldump 등을 이용해서 데이터 백업후, 업그레이드 된 MySQL에 적재 

## 인플레이스 업그레이드

업그레이드는, `마이너` -> `마이너` 와 `마이너` -> `메이저` 버전의 업그레이드를 생각해볼 수 있다.  
  
* 마이너 버전간의 업그레이드 : 대부분 데이터 파일의 변경 없이 이루어질 수 있을 것이다.     
* 메이저 버전간의 업그레이드 : 변경량이 많아서 반드시 직전 버전에서의 업그레이드만을 허용하고 있다.  
 
예를 들어, `5.1` -> `8.0` 업그레이드가 아니라 `5.2` -> `5.3` -> `...` -> `8.0`로 진행한다.    
**이 같은 이유로, 버전 차이가 심할 경우 mysqldump 방식을 이용하는 논리적 업그레이드가 나을 수 있다.**      
 
인플레이스 업그레이드에서 한가지 더 주의해야할 점은     
메이저 버전 업그레이드가 특정 마이너 버전에서만 가능한 경우도 있다. 
GA 버전(안정성이 확정된 버전)이 아닌 경우, 업그레이드가 어려울 수 있으며     
특정 경우에는 이전 메이저 버전에도 가장 최근의 마이너 버전에서만 인플레이스 업그레이드를 지원할 수 있다.     
**따라서 새로운 버전의 MySQL 서버를 선택할 때도, 최소 15~20번 이상의 마이너 버전을 선택하는 것이 좋다.**   

### 8.0 업그레이드시 고려사항   

**사용자 인증 방식 변경**    
* Caching SHA-2 Authentication 인증 방식이 기본 인증방식으로 바뀌었다.   
* 8.0 버전 이후에 생성된 계정은 Caching SHA-2 Authentication 인증 방식 사용  
* 5.7 버전에 존재했던 계정들은 Native Authentication 인증 방식을 사용 중이다.
* 인증 방식을 변경하고자 한다면 서버 시작시 `--default-authentication-pulgin=mysql_native_password` 파라미터를 활성화한다.

**MySQL 8.0과 호환성 체크**    
* 손상된 FRM 파일이나 호환되지 않는 데이터 타입 또는 함수가 있는지 `mysqlcheck` 유틸리티를 이용해 확인해본다.
   
**외래키 이름의 길이**   
* 8.0 버전에서 외래키의 이름이 64글자로 제한된다.  
* 기존 외래키 이름을 확인하고 변경한다.  

**인덱스 힌트**    
* 5.X 버전에서 사용되던 인덱스 힌트가 있다면, 먼저 성능 테스트를 수행하자   
* 버전 변화에 따라 성능이 저하 될 수도 있다.(이전 버전에 최적화이므로 -> 예를 들면 카운트?)   

**Group By에 사용된 정렬 옵션**   
* 5.X 버전에서 GROUP BY 절의 컬럼뒤에 ASC 나 DESC 사용하고 있다면 먼저 제거하거나 다른 방식으로 변경한다.   

**파티션을 위한 공용 테이블스페이스**   
* 8.0 이후 버전에서는 파티션의 각 테이블스페이스를 공용 테이블스페이스에 저장할 수 없다.   
* 그래서 파티션의 테이블스페이스가 공용 테이블스페이스에 저장된 것이 있는지 먼저 확인하자   
* 있다면, `ALTER TABLE ... REORGANIZE` 명령을 실행해 개별 테이블스페이스를 사용하도록 변경한다.  

### 8.0 업그레이드 작업
  
MySQL 8.X 부터는 업그레이드시 시스템 테이블의 정보와 데이터 딕셔너리 정보의 포맷이 완전히 바뀌었다.   
`5.X` -> `8.X` 로 버전 업그레이드 진행시 2단계로 나뉘어서 처리한다.   

1. 데이터 딕셔너리 업그레이드 : 
    * 5.7 버전까지는 데이터 딕셔너리 정보가 FRM 확장자를 가진 파일로 별도로 보관되었다.    
    * 8.0 버전부터는 데이터 딕셔너리 정보가 지원되는 InnoDB 테이블로 저장되도록 개선되었다. 
2.  
    








